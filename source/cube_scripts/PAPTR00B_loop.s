; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.

*cluster transit 1-5 START EXIT
LOOP TOD=1,5,1

 IF(TOD=1) TPER='EA' ASSIGNNAME='EA Period'  PER ='EA' TPER2='NT' TPER3='OP'
 IF(TOD=2) TPER='AM' ASSIGNNAME='AM Period'  PER ='AM' TPER2='AM' TPER3='PK'
 IF(TOD=3) TPER='MD' ASSIGNNAME='MD Period'  PER ='MD' TPER2='MD' TPER3='OP'
 IF(TOD=4) TPER='PM' ASSIGNNAME='PM Period'  PER ='PM' TPER2='PM' TPER3='PK'
 IF(TOD=5) TPER='NT' ASSIGNNAME='NT Period'  PER ='NT' TPER2='NT' TPER3='OP'

 
 DISTRIBUTEMULTISTEP PROCESSID='transit' PROCESSNUM=@TOD@


RUN PGM=PUBLIC TRANSPORT PRNFILE="%SCENARIO_DIR%\transit\XIT_WK_LD_PRN_%PREV_ITER%_@TPER@.prn" MSG='@TPER@ Walk Transit Assignment'
FILEI ROUTEI[1] = "%SCENARIO_DIR%\transit\XIT_WK_RTE_%PREV_ITER%_@TPER@.RTE"
FILEO LINKO[1] = "%SCENARIO_DIR%\transit\XIT_WK_LD_%PREV_ITER%_@TPER@.DBF",
ONOFFS=Y, NTLEGS=Y, SKIP0=Y
FILEI MATI[1] = "%SCENARIO_DIR%\transit\XIT_TRIP_%PREV_ITER%_@TPER@_CLEAN.trp"
FILEO REPORTO = "%SCENARIO_DIR%\transit\XIT_WK_LD_RPT_%PREV_ITER%_@TPER@.RPT"
FILEI NETI = "%SCENARIO_DIR%\transit\XIT_WK_NET_%PREV_ITER%_@TPER@.NET"
FILEO NETO = "%SCENARIO_DIR%\transit\XIT_LDNET_WK_%PREV_ITER%_@TPER@.net"

    PARAMETERS  HDWAYPERIOD=@TOD@
    
 PARAMETERS TRIPSIJ[1] = MI.1.WalkToTransit, NOROUTEMSGS = 9999, NOROUTEERRS = 9999   ; ASSIGN WALK TO Transit TRIPS

 REPORT LINES=T, SORT=MODE, LINEVOLS=T, STOPSONLY=T, SKIP0=T, XFERSUM=MODE


ENDRUN

ENDDISTRIBUTEMULTISTEP
ENDLOOP

Wait4Files FILES='transit1.script.end, transit2.script.end, transit3.script.end, transit4.script.end, transit5.script.end', CheckReturnCode=T, DelDistribFiles=T

*cluster transit 1-5 CLOSE EXIT