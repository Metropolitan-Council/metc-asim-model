; PILOT Script
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.

ITER = 1
PREV_ITER = ITER - 1
; End of PILOT Script

; Script for program MATRIX in file "C:\Projects\TourCast\MetCouncilCodeBase\Cube\Catalog\CUBE\TCMAT00A.S"
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=MATRIX MSG='Set Inputs and Intermediate File Names - Part 1'
FILEO PRINTO[1] = "%CATALOG_DIR%\\TourCast\Script\CubeKeyValues.py"

;The python configuration file has variable references like this:
;DataReferences=%"Files":___FILE___% where ___FILE___ is a variable holding the file path
;This Matrix module writes these lines out to a Python file that is imported by the config files.  

; TODO: Add feedback iteration to create unique file from each round
; TODO: depending on first or subsequent iteration, specify the skims

Zones=1    ;a Cube setting required for record file processing

If (_writefiles==0) 
  Print printo=1 List='#These lines are generated by Cube to pass file names from Catalog Keys to Python Configuration'
  Print printo=1 List='cube___HOUSEHOLDS_FILE___ = r"', '%households%"'
  Print printo=1 List='cube___ZONES_FILE___ = r"', '%zone_attribs%"'
  Print printo=1 List='cube___PERSONS_FILE___ = r"', '%persons%"'
  Print printo=1 List='cube___DAILY_ACTIVITY_PATTERNS___ = r"', '%SCENARIO_DIR%\TC_OutputDAP_%ITER%.dbf"'
  Print printo=1 List='cube___MODELED_HOUSEHOLDS_FILE___ = r"', '%SCENARIO_DIR%\TC_HouseholdModeledData_%ITER%.dbf"'
  Print printo=1 List='cube___PASS_MODEL___ = r"', '%SCENARIO_DIR%\TC_PassModel_%ITER%.dbf"'
  Print printo=1 List='cube___PASS_MODEL_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_PassModelSummary_%ITER%.dbf"'  
  Print printo=1 List='cube___DAILY_ACTIVITY_PATTERNS_FIRST_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputDAPFirstTours_%ITER%.dbf"'
  Print printo=1 List='cube___DAILY_ACTIVITY_PATTERNS_SECOND_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputDAPSecondTours_%ITER%.dbf"'
  Print printo=1 List='cube___DAILY_ACTIVITY_PATTERNS_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputDAPStats_%ITER%.dbf"'
  Print printo=1 List='cube___DAILY_ACTIVITY_PATTERN_PRE_PROCESSED_DATA___ = r"', '%SCENARIO_DIR%\TC_OutputPersonsPreDAP_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOURS___ = r"', '%SCENARIO_DIR%\TC_FullyJointTours_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_PERSON_LINK_TABLE___ = r"', '%SCENARIO_DIR%\TC_FullyJointPersonTourLinkTable_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_FullyJointTourSummaryByHousehold_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_PARTICIPATION_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_FullyJointTourParticipationSummary_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_GENERATION_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_FullyJointTourGenerationSummary_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_DESTINATION_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceFullyJoint_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceFullyJointStats_%ITER%.txt"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_PRE_PROCESSED_DATA___ = r"', '%SCENARIO_DIR%\TC_PreFJTPersonModeledData_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_TIME_OF_DAY___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursFullyJoint_%ITER%.dbf"'
  Print printo=1 List='cube___FULLY_JOINT_TOUR_PERSON_SCHEDULES___ = r"', '%SCENARIO_DIR%\TC_OutputPersonTODSchedulesFullyJoint_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputINMTours_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_ESCORT_TOUR_DESTINATION_CHOICES___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceINMEscort_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_ESCORT_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceINMEscortStats_%ITER%.txt"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_PRE_PROCESSED_DATA___ = r"', '%SCENARIO_DIR%\TC_PreINMPersonModeledData_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_DESTINATION_CHOICES___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceINM_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceINMStats_%ITER%.txt"'
  Print printo=1 List='cube___FIRST_MANDATORY_TOUR_TIME_OF_DAY___ = r"', '%SCENARIO_DIR%\TC_OutputPreTODFirstTours_%ITER%.dbf"'
  Print printo=1 List='cube___SECOND_MANDATORY_TOUR_TIME_OF_DAY___ = r"', '%SCENARIO_DIR%\TC_OutputPreTODSecondTours_%ITER%.dbf"'
  Print printo=1 List='cube___SCHOOL_ESCORT_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputPostSchoolEscortTours_%ITER%.dbf"'
  Print printo=1 List='cube___SCHOOL_ESCORT_STOPS___ = r"', '%SCENARIO_DIR%\TC_OutputSchoolEscortStops_%ITER%.dbf"'
  Print printo=1 List='cube___SCHOOL_ESCORT_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputSchoolEscortStats_%ITER%.dbf"'
  Print printo=1 List='cube___SCHOOL_LOCATIONS___ = r"', '%SCENARIO_DIR%\TC_OutputSchoolLocationTest_%ITER%.dbf"'
  Print printo=1 List='cube___SCHOOL_LOCATIONS_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputSchoolLocationStatsTest_%ITER%.txt"'
  Print printo=1 List='cube___STOP_DESTINATION_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputStopsWithDestinations_%ITER%.dbf"'
  Print printo=1 List='cube___STOP_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputStopDestinationChoiceStats_%ITER%.txt"'
  Print printo=1 List='cube___STOP_GENERATION_STOPS_HOME_BASED___ = r"', '%SCENARIO_DIR%\TC_OutputStops_%ITER%.dbf"'
  Print printo=1 List='cube___STOP_GENERATION_TOURS_HOME_BASED___ = r"', '%SCENARIO_DIR%\TC_OutputToursAfterStopGen_%ITER%.dbf"'
  Print printo=1 List='cube___TRIP_TIME_OF_DAY___ = r"', '%SCENARIO_DIR%\TC_OutputTrips_%ITER%.dbf"'
  Print printo=1 List='cube___STOPS_WITH_TOUR_OFFSET_TIMES___ = r"', '%SCENARIO_DIR%\TC_OutputStopsWithTourOffsetTimes_%ITER%.dbf"'
  Print printo=1 List='cube___UNIVERSITY_TOUR_DESTINATION_CHOICE_FIRST_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceUniversityFirstToursTest_%ITER%.dbf"'
  Print printo=1 List='cube___UNIVERSITY_TOUR_DESTINATION_CHOICE_SECOND_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceUniversitySecondToursTest_%ITER%.dbf"'
  Print printo=1 List='cube___UNIVERSITY_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceUniversityStats_%ITER%.txt"'
  Print printo=1 List='cube___WORK_TOUR_DESTINATION_CHOICE_FIRST_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceWorkFirstToursTest_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_TOUR_DESTINATION_CHOICE_SECOND_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceWorkSecondToursTest_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceWorkStats_%ITER%.txt"'
  Print printo=1 List='cube___HOME_BASED_TOUR_MODE_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputModeChoice_%ITER%.dbf"'
  Print printo=1 List='cube___HOME_BASED_TOUR_MODE_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputModeChoiceForStats_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_CHOICE_FIRST_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursDAPFirst_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_PERSON_SCHEDULES_FIRST_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputPersonTODSchedulesDAPFirstTours_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_FIRST_TOUR_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTODStatsDAPFirstTours_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_CHOICE_SECOND_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursDAPSecond_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_PERSON_SCHEDULES_SECOND_TOURS___ = r"', '%SCENARIO_DIR%\TC_OutputPersonTODSchedulesDAPSecondTours_%ITER%.dbf"'
  Print printo=1 List='cube___DAP_TOUR_TIME_OF_DAY_SECOND_TOUR_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTODStatsDAPSecondTours_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_ESCORT_TOUR_TIME_OF_DAY_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursIndNonMandEscort_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_ESCORT_TOUR_TIME_OF_DAY_PERSON_SCHEDULES___ = r"', '%SCENARIO_DIR%\TC_OutputPersonTODSchedulesIndNonMand_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_TIME_OF_DAY_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursIndNonMand_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_TIME_OF_DAY_PERSON_SCHEDULES___ = r"', '%SCENARIO_DIR%\TC_OutputPersonTODSchedulesIndNonMandNonEscort_%ITER%.dbf"'
  Print printo=1 List='cube___INDIVIDUAL_NON_MANDATORY_TOUR_TIME_OF_DAY_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_INDIVIDUAL_NON_MANDATORY_TOUR_TIME_OF_DAY_SUMMARY_%ITER%.dbf"'
  Print printo=1 List='cube___TRIPS_WITH_MODES___ = r"', '%SCENARIO_DIR%\TC_OutputTripModes_%ITER%.dbf"'
  Print printo=1 List='cube___WORKPLACE_LOCATIONS___ = r"', '%SCENARIO_DIR%\TC_OutputPersonsWorkplaceLocationTest_%ITER%.dbf"'
  Print printo=1 List='cube___WORKPLACE_LOCATIONS_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputPersonsWorkplaceLocationStats_%ITER%.txt"'
  Print printo=1 List='cube___NUM_CARS_PER_HOUSEHOLD___ = r"', '%SCENARIO_DIR%\TC_OutputNCars_%ITER%.dbf"'
  Print printo=1 List='cube___VEHICLE_AVAILABILITY_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputAAStats_%ITER%.dbf"'
  Print printo=1 List='cube___PERSONS_ADULTS___ = r"', '%SCENARIO_DIR%\TC_OutputPersonsAdultsAA_%ITER%.dbf"'
  Print printo=1 List='cube___PERSONS_CHILDREN___ = r"', '%SCENARIO_DIR%\TC_OutputPersonsChildrenAA_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_SUBTOURS___ = r"', '%SCENARIO_DIR%\TC_OutputWBSTGeneration_%ITER%.dbf"'  
  Print printo=1 List='cube___WORK_BASED_STOPS___ = r"', '%SCENARIO_DIR%\TC_OutputStopsWorkBasedStopGen_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_DESTINATION_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceWorkBased_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_DESTINATION_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTourDestinationChoiceWorkBasedStats_%ITER%.txt"'
  Print printo=1 List='cube___WORK_BASED_TOUR_TIME_OF_DAY_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputTODToursWorkBased_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_TIME_OF_DAY_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputTODStatsWorkBased_%ITER%.dbf"'
  Print printo=1 List='cube___WORKPLACE_LOCATIONS_PERSONS___ = r"', '%SCENARIO_DIR%\TC_OutputUsualWorkplaceExistenceTest_%ITER%.dbf"'
  Print printo=1 List='cube___WORKPLACE_LOCATIONS_PERSONS_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputPersonStats_UsualWorkplaceExistence_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_PRE_PROCESSED_DATA___ = r"', '%SCENARIO_DIR%\TC_OutputPreWBST_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_MODE_CHOICE___ = r"', '%SCENARIO_DIR%\TC_OutputModeChoiceWorkBased_%ITER%.dbf"'
  Print printo=1 List='cube___WORK_BASED_TOUR_MODE_CHOICE_SUMMARY___ = r"', '%SCENARIO_DIR%\TC_OutputModeChoiceForStatsWorkBased_%ITER%.dbf"'
  Print printo=1 List='cube___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\TripTable.mat"'
  Print printo=1 List='#End of Cube generated lines'
  _writefiles=1
Endif 

ENDRUN


; Script for program MATRIX in file "C:\Projects\TourCast\MetCouncilCodeBase\Cube\Catalog\CUBE\TCMAT00B.S"
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM=MATRIX MSG='Set Inputs and Intermediate File Names - Part 2'
FILEO PRINTO[1] = "%CATALOG_DIR%\TourCast\Script\MatrixKeyValues.py"

;The python configuration file has variable references like this:
;DataReferences=%"Files":___FILE___% where ___FILE___ is a variable holding the file path
;This Matrix module writes these lines out to a Python file that is imported by the config files.  

Zones=1    ;a Cube setting required for record file processing

If (_writefiles==0) 
  Print printo=1 List='#These lines are generated by Cube to pass file names from Catalog Keys to Python Configuration'
  Print printo=1 List='cube___OD_DISTANCE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_SKIM_%PREV_ITER%_AM.skm', '"'
  Print printo=1 List='cube___AM_PEAK_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_SKIM_%PREV_ITER%_AM.skm', '"'
  Print printo=1 List='cube___MIDDAY_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_SKIM_%PREV_ITER%_MD.skm', '"'
  Print printo=1 List='cube___PM_PEAK_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_SKIM_%PREV_ITER%_PM.skm', '"'
  Print printo=1 List='cube___OVERNIGHT_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_SKIM_%PREV_ITER%_NT.skm', '"'
  Print printo=1 List='cube___NM_MATRIX___ = r"', '%SCENARIO_DIR%\NM_SKIM.skm', '"'  
  Print printo=1 List='cube___PEAK_WALK_TO_TRANSIT_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_WK_SKIM_%PREV_ITER%_PK.skm', '"'
  Print printo=1 List='cube___PEAK_DRIVE_TO_TRANSIT_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_DR_SKIM_%PREV_ITER%_PK.skm', '"'
  Print printo=1 List='cube___OFF_PEAK_WALK_TO_TRANSIT_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_WK_SKIM_%PREV_ITER%_OP.skm', '"'
  Print printo=1 List='cube___OFF_PEAK_DRIVE_TO_TRANSIT_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_DR_SKIM_%PREV_ITER%_OP.skm', '"'
  
  Print printo=1 List='AM1___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_AM1.trp', '"'
  Print printo=1 List='AM2___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_AM2.trp', '"'
  Print printo=1 List='AM3___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_AM3.trp', '"'
  Print printo=1 List='AM4___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_AM4.trp', '"'

  Print printo=1 List='MD___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_MD.trp', '"'  
  
  Print printo=1 List='PM1___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_PM1.trp', '"'
  Print printo=1 List='PM2___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_PM2.trp', '"'
  Print printo=1 List='PM3___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_PM3.trp', '"'
  Print printo=1 List='PM4___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_PM4.trp', '"'

  Print printo=1 List='EV___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_EV.trp', '"'  
  Print printo=1 List='NT___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\HWY_TRIP_%ITER%_ON.trp', '"'    
  
  Print printo=1 List='PeakTransit___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_TRIP_%ITER%_PK.trp', '"'
  Print printo=1 List='OffPeakTransit___TRIP_TABLE_MATRIX___ = r"', '%SCENARIO_DIR%\XIT_TRIP_%ITER%_OP.trp', '"'
	Print printo=1 List='#End of Cube generated lines'
  _writefiles=1
Endif 

ENDRUN


; PILOT Script
FILEO PRINTO[1] = "%SCENARIO_DIR%\TourCastStatus.prn"
; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.

; 
; Build a batchfile to drive TourCast and show outputs (calling direct from Cube hides status)
;

* echo %echo on > TourCastRun.bat
* echo %cd ..\TourCast\bin >> TourCastRun.bat
* echo %echo TourCast Aborted ^> ..\..\Cube\TC_error.txt >> TourCastRun.bat
;
; Vehicle Availability Sequence
;
IF (%TC_vehavail% == 1)

  * echo ModelEngine.exe VehicleAvailabilityModel.py >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe VehicleAvailabilityModelPostProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat

ENDIF

;
; School Location
;
IF (%TC_schLocation% == 1)

  * echo ModelEngine.exe SchoolLocationConstrChoice.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  
ENDIF

;
; Usual Work Location
;
IF (%TC_workLocation% == 1)

  * echo ModelEngine.exe WorkplaceLocationChoiceModelPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat    
  * echo ModelEngine.exe UsualWorkplaceLocationChoiceModel.py UsualWorkplaceLocationTourModeChoiceLogsumModel.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat    
  
ENDIF

;
; Pass Models
;
IF (%TC_pass% == 1)
  * echo ModelEngine.exe PassModels.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
    
ENDIF

;
; DAP
;
IF (%TC_DAP% == 1)
  * echo ModelEngine.exe DailyActivityPatternModelPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe DailyActivityPatternModel.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat      
ENDIF

;
; Mandatory Tour Destination Choice (Work and University)
;
IF (%TC_mandTourDest% == 1)
  * echo ModelEngine.exe TourDestinationChoiceUniversity.py  TourModeChoiceLogsum_SchoolLocation.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe TourDestinationChoiceWork.py TourModeChoiceLogsum_Work.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Mandatory Tour TOD
;
IF (%TC_mandTourTOD% == 1)
  * echo ModelEngine.exe MandatoryTourTimeOfDayChoiceModelPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe TourTimeOfDayDAPFirstTours.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe TourTimeOfDayDAPSecondTours.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  
ENDIF

;
; School Escorting
;
IF (%TC_schEscort% == 1)
  * echo ModelEngine.exe SchoolEscortModel.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Fully Joint Tours
;
IF (%TC_FJ% == 1)
  * echo ModelEngine.exe FullyJointTourPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe FullyJointTour.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe FullyJointTourDestinationChoice.py TourModeChoiceLogsum_FullyJoint.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe FullyJointTourTimeOfDay.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF
  
;
; INM Tours
;
IF (%TC_INM% == 1)
  * echo ModelEngine.exe IndividualNonMandatoryPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe IndividualNonMandatory.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe IndividualNonMandatoryEscortTourDestinationChoice.py TourModeChoiceLogsum_IndividualNonMandatory_Escort.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe IndividualNonMandatoryTourDestinationChoice.py TourModeChoiceLogsum_IndividualNonMandatory.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe TourTimeOfDayIndNonMandNonEscort.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe TourTimeOfDayIndNonMandEscort.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Stop Generation
;
IF (%TC_stopGen% == 1)
  * echo ModelEngine.exe StopGeneration.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Home-Based Tour Mode Choice
;
IF (%TC_tourMC% == 1)
  * echo ModelEngine.exe TourModeChoiceHomeBased.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Work-Based Tours
;
IF (%TC_WB% == 1)
  * echo ModelEngine.exe WorkBasedSubTourPreProcessor.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe WorkBasedSubTour.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe WorkBasedTourDestinationChoice.py TourModeChoiceLogsum_WorkBased.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe WorkBasedTourTimeOfDay.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe WorkBasedStopGeneration.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe WorkBasedTourModeChoice.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Stop-Level Models
;
IF (%TC_stopDestTOD% == 1)
  * echo ModelEngine.exe StopDestination.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
  * echo ModelEngine.exe StopTimeOfDay.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Trip Mode Choice
;
IF (%TC_tripMC% == 1)
  * echo ModelEngine.exe TripModeChoice.py  >>  TourCastRun.bat
  * echo %IF ERRORLEVEL 2 GOTO TCERROR >> TourCastRun.bat  
ENDIF

;
; Write error checking to TourCastRun.bat
;
* echo %del ..\..\Cube\TC_error.txt >> TourCastRun.bat
* echo exit >> TourCastRun.bat
* echo :TCERROR >> TourCastRun.bat
* echo %echo TourCast Component Failed
* echo %echo TourCast Error ^> ..\..\Cube\TC_error.txt >> TourCastRun.bat
* echo %pause >> TourCastRun.bat
* echo exit >> TourCastRun.bat

* start /wait TourCastRun.bat
* dir TC_error.txt
  IF (ReturnCode == 0) 
    PRINT LIST='TourCast Model Error - see log files for more information'
    * type TC_error.txt
    abort
  ENDIF 
; End of PILOT Script

